#!/usr/bin/make -f

src := .
out := _out

mk := $(dir $(realpath $(lastword $(MAKEFILE_LIST))))

$(out)/%.html: $(src)/%.md $(out)/index.json $(src)/config.json $(src)/header.mustache $(src)/body.post.mustache $(src)/footer.mustache
	$(mkdir)
	$(mk)/nbe-md2html $^ > $@

# pages.src := $(shell find $(src)/pages -type f)
# pages.md.src := $(filter %.md, $(pages.src))
# pages.md.dest := $(patsubst $(src)/%.md, $(out)/%.html, $(pages.md.src))

$(out)/pages/%.html: $(src)/pages/%.md $(out)/index.json $(src)/config.json $(src)/header.mustache $(src)/body.page.mustache $(src)/footer.mustache
	$(mkdir)
	$(mk)/nbe-md2html $^ > $@

mkdir = mkdir -p $(dir $@)

$(out)/index.json: $(shell find $(src)/[0-9]* $(src)/pages -type f)
	$(mkdir)
	$(mk)/nbe-index $^ > $@

.DELETE_ON_ERROR:
